# ADR-001: API Gateway v2

- **Status:** Accepted (2027-03-18)
- **Context:** API Gateway агрегирует внешние запросы и проксирует их во внутренние сервисы.
- **Decision:** Реализовать слой маршрутизации на TypeScript, использовать общую очередь `events.high`
  для коммуникации с воркерами.
- **Consequences:**
  - Открытый REST эндпоинт `/api/v1/metrics` доступен для внешнего мониторинга.
  - Воркер должен быть способен масштабироваться независимо, см. `apps/worker`.
  - Все обновления архитектуры фиксируются в `docs/ADR-001-current.md`.

## Navigation Bridge Telemetry

Компонент API обязан регистрировать каждый новый мост маршрутизации, чтобы `lanes-summary`
мог измерять документированность экспортов. Для этого используется функция
`registerNavigationBridge`, которая возвращает текущие метрики и логирует callback
через `analysis-cli doc insert`. Агент `docs-process-file` обязан упомянуть эту команду
в `mentions`, чтобы wf-structure-agents мог сверить CLI.

API публикует снапшоты метрик и экспортирует их в `global/reports/doc-matches.json`.
В отчёте фиксируются те сущности, которые освещены в документации, и недостающие
экспорты, требующие доработки.
